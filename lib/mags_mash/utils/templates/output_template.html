<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css"></link>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"></link>
<style>
/*CSS styling*/

ul{
    list-style-type: none;
}

.table a {
    display: block;
    text-decoration: none;
}

.caret {
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none
}

.caret::before{
    content: "\25B6";
    color: black;
    display: inline-block;
    margin-right: 8px;
}

.caret-down::before{
    -ms-transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    transform: rotate(90deg);
}

.nested {
    display: none
}

.active {
    display: block;
}

.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}
.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.0s;
    font-size: 17px;
}

.tab button:hover{
    background-color: #ddd;
}

.tab button.active{
    background-color: #ccc;
}

</style>

</head>
<!-- HTML below -->
<body>
<div class='tab'>
    <button class="tablinks" onclick="openTab(event, 'stats')" id="defaultOpen">List View</button>
    <button class="tablinks" onclick="openTab(event, 'tree')">Ecosystem Tree</button>
    <!--<button class="tablinks" onclick="openTab(event, 'Map View')">map</button>-->
</div>

<!--
Recursive Tree structure below, fill in with tree=
-->
<div id="tree" class="tabcontent">
    {%- for t in tree recursive %}
        {%- if t.children -%}
        <li><span class="caret">{{t.name}}</span>
            <ul class="nested">{{ loop(t.children) }} </ul>
        </li>
        {%- else -%}
        <li>{{t.name}}</li>
        {%- endif %}
    {%- endfor %}
</div>
<!--
Statistics List view
-->
<div id='stats' class="tabcontent">
    <table id='stats_table' class='table table-striped table-bordered'>
        <thead>
            <tr>
                <th>Distance</th>
                <th>MAG ID</th>
                <th>KBase ID</th>
                <th>GOLD Analysis Project ID</th>
                <th>GOLD Sequencing Project ID</th>
                <th>IMG Genome ID</th>
                <th>Completeness</th>
                <th>Contamination</th>
                <th>MIMAG</th>
                <th>Project/Study Name</th>
            </tr>
        </thead>
        <tbody>
            {% for item in stats %}
            <tr>
                <td>{{item.dist}}</td>
                <td>{{item.mag_id}}</td>
                <td>{{item.kb_id}}</td>
                <td>
                    <a href="{{ 'https://gold.jgi.doe.gov/analysis_project?id=%s'%item.GOLD_Analysis_ID }}">{{item.GOLD_Analysis_ID}}</a>
                </td>
                <td>
                    <a href="{{ 'https://gold.jgi.doe.gov/sequencing_project?id=%s'%item.GOLD_Sequencing_ID }}">{{item.GOLD_Sequencing_ID}}</a>
                </td>
                <td>{{item.IMG_Genome_ID}}</td>
                <td>{{item.completeness}}</td>
                <td>{{item.contamination}}</td>
                <td>{{item.MIMAG}}</td>
                <td>{{item.project}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>    
</div>
<!--
Google maps view below
Looks like we'll have to use the google maps api to get this done

NOTE: hold off on this for now.

<div id="map" class="tabcontent"></div>
-->
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script type="text/javascript">
    $(document).ready(function()){
        $('#stats_table').Datatable({
            scrollY:   '30vh',
            scrollCollapse: true,
            paging: false
        })
    }
</script>

<script>
    var toggler = document.getElementsByClassName("caret");
    var i;

    for (i = 0; i < toggler.length; i++) {
      toggler[i].addEventListener("click", function() {
        this.parentElement.querySelector(".nested").classList.toggle("active");
        this.classList.toggle("caret-down");
      });
    }
</script>

<script>
    function openTab(evt, name) {
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }  

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(name).style.display = "block";
        evt.currentTarget.className += " active";   
    }
    document.getElementById("defaultOpen").click();
</script>
</body>
</html>
